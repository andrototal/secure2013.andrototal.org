<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>AndroTotal: A Scalable Framework for Android Antivirus Testing</title>

    <meta name="description" content="A Scalable Framework for Android Antivirus Testing">
    <meta name="author" content="Federico Maggi, Andrea Valdi, Stefano Zanero">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/andrototal.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/solarized_dark.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write('<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">');
    </script>

    <style type="text/css" media="screen,print">
      strike {
        position: relative;
        opacity: 0.5;
      }

      strike::after {
        border-bottom: 5px solid red;
        content: "";
        left: 0;
        position: absolute;
        right: 0;
        top: 50%;
      }

      img.logo {
        height: 80px;
        background: white !important;
      }

      a img {
        border: 0 !important;
      }
    </style>

    <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">
      <div class="slides">
        <section data-markdown>
          <script type="text/template">
            # AndroTotal
            ## A Scalable Framework for
            ## Android Antimalware Testing

            <a href="http://maggi.cc"><strong>Federico Maggi</strong></a>, <a href="http://andreavaldi.org">Andrea Valdi</a>, <a href="http://zanero.org">Stefano Zanero</a>

            <a href="http://polimi.it">Politecnico di Milano</a>, <a href="http://www.deib.polimi.it">DEIB</a>

            <a href="mailto:fede@maggi.cc">fede@maggi.cc</a>

            <a href="http://necst.it"><img class="logo" src="img/necst.png" class="" alt="" /></a>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Roadmap

            1. Android threats and protections

            1. Limitations

            1. Testing antimalware

            1. AndroTotal

            1. Status
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ## 1. Android threats and protections

            #### 2. Limitations

            #### 3. Testing antimalware

            #### 4. AndroTotal

            #### 5. Status
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Android Facts

            * <a href="http://www.idc.com/getdoc.jsp?containerId=prUS24257413">Android is the most popular mobile platform (79%)</a>

            * Rich marketplaces stocked with apps

            * Very attractive target for attackers

            ![Alt](img/android-stats.png)
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Attackers Goals

            <ul class="fragment">
              <li class="fragments">Steal sensitive data (intercept texts or calls)</li>
              <li class="fragments">Turn devices into bots (perform malicious actions)</li>
              <li class="fragments">Financial gain (call or text premium numbers)</li>
            </ul>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Growth of Malicious Apps (2011&mdash;2012)

            <div class="fragment">
              <img width="70%" src="img/malware-growth.jpg" />

              http://blog.trendmicro.com/trendlabs-security-intelligence/byod-a-leap-of-faith-for-enterprise-users/
              </div>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Number of mobile "threats" (Q1 2013)

            * Symantec: ~3,900

            * McAfee: ~60,000

            * TrendMicro: ~509,000

            <a href="https://docs.google.com/presentation/d/1YDYUrD22Xq12nKkhBfwoJBfw2Q-OReMr0BrDfHyfyPw/edit?forcehl=1&hl=en#slide=id.g1202bd8e5_0140">Google @ VB2013: Situation is vastly exaggerated</a>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Google's Layered Security Approach

            <ul class="fragment">
              <li class="fragments">Google Play vetting</li>
              <li class="fragments">Install and permission confirmation</li>
              <li class="fragments">SMS/call blacklisting and quota</li>
              <li class="fragments">Runtime checks (?)</li>
              <li class="fragments">App sandboxing</li>
            </ul>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### App Sandboxing

            <img width="50%" src="img/android.png" />

            "Sensitive" operations require static permissions
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            #### 1. Threats and protections

            ## 2. Limitations

            #### 3. Testing antimalware

            #### 4. AndroTotal

            #### 5. Status
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Antimalware Limitations

            <ul class="fragment">
            <li class="fragments">No primitives for auditing running processes</li>
            <li class="fragments">Workarounds:
              <ul>
                <li class="fragments">Signature-based matching</li>

                <li class="fragments">Custom kernel (e.g., intercept syscalls)</li>
                <li class="fragments">Root the device and increase the antimalware's privileges</li>
              </ul>

            </li>
            </ul>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Malware Limitations

            <ul class="fragment">
              <li class="fragments">Less freedom: a malware is an isolated app itself</li>
              <li class="fragments">Workarounds:
                <ul>
                  <li class="fragments">Social engineering</li>
                  <li class="fragments"><strong>Signature evasion</strong></li>
                </ul>
              </li>
            </ul>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Signature Evasion

            <h4 class="fragment">More Variants than Distinct Families</h4>

            <div class="fragment">
            <img width="80%" src="img/many-variants.png" />

            <p>http://go.eset.com/us/resources/white-papers/Trends_for_2013_preview</p>
            </div>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Signature Evasion

            #### obfuscation, encryption, repackaging

            [ADAM: An Automatic and Extensible Platform to Stress Test Android Anti-Virus Systems, DIVMA2013](http://www.cse.cuhk.edu.hk/~pclee/www/pubs/dimva12.pdf)

            &nbsp;

            [DroidChameleon: Evaluating Android Anti-malware against Transformation Attacks, AsiaCCS2013](http://www.cs.ncsu.edu/faculty/jiang/pubs/ASIACCS13_DroidChameleon.pdf)

            &nbsp;

            Based on this research we implemented 11 mutation scripts.

          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            #### 1. Threats and protections

            #### 2. Limitations

            ## 3. Testing antimalware

            #### 4. AndroTotal

            #### 5. Status
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Antimalware Products

            <ul class="fragment">
              <li class="fragments">About 100 (free) antimalware apps</li>
              <li class="fragments">Extra features on rooted devices</li>
            </ol>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### How to test them?

            <ol class="fragment">
              <li class="fragments">Obtain <strong>M</strong> samples of known malware</li>
              <li class="fragments">Apply <strong>T</strong> transformations to each sample</li>
              <li class="fragments">Analyze <strong>M</strong> &times; <strong>T</strong> variants with <strong>P</strong> antimalware apps </li>
              <li class="fragments">Repeat for each of the <strong>A</strong> Android versions</li>
            </ol>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Numbers

            <ul class="fragment">
              <li class="fragments">M = 1,000 (very conservative)</li>
              <li class="fragments">T = 11
              <li class="fragments">P = 100</li>
              <li class="fragments">A = 3 (2.3, 4.1, 4.2)</li>
            </ul>

            <br />

            <h3 class="fragment">1,000 &times; 11 &times; 100 &times; 3 = 3,300,000 tests</h3>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ## Lack of Automation Tools

            <h3 class="fragment">VirusTotal.com?</h3>

            <ul class="fragment">
              <li class="fragments">Command-line, desktop-based AVs with signatures for Android</li>
              <li class="fragments">Unclear whether the same signatures will work on the respective mobile products</li>
              <li class="fragments">No versioning support</li>
            </ul>
            </div>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### State of the Art

            <ul>
            <li class="fragment">H. Pilz, <em>"Building a test environment for Android anti-malware tests,"</em> Virus Bulletin Conference '12

              <ul>
                <li class="fragments">Human oracle is needed</li>
              </ul>
            </li>

            <li class="fragment">M. Zheng, P. P. C. Lee, and J. C. S. Lui, <em>"ADAM: An Automatic and Extensible Platform to Stress Test Android Anti-Virus Systems,"</em> DIMVA'12

              <ul>
                <li class="fragments">Focus on transformation</li>
              </ul>
            </li>

            <li class="fragment">V. Rastogi, Y. Chen, and X. Jiang, <em>"DroidChameleon: Evaluating Android Anti-malware against Transformation Attacks,"</em> AsiaCCS'13

              <ul>
                <li class="fragments">Focus on transformation</li>
              </ul>
            </li>
            </ul>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Technical Requirements

            <ul class="fragment">
              <li class="fragments">Scalable architecture</li>
              <li class="fragments">Android antimalware products are UI driven</li>
            </ul>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            #### 1. Threats and protections

            #### 2. Limitations

            #### 3. Testing antimalware

            ## 4. AndroTotal

            #### 5. Status
          </script>
        </section>

        <section>
          <section data-markdown>
            <script type="text/template">
              <img width="40%" src="img/andrototal_logo.png" style="background: white !important;" />

              <ul>
                <li class="fragments">SDK for writing UI tests/scrapers</li>
                <li class="fragments">Pluggable adapters for each antimalware</li>
                <li class="fragments">Parametric tests (e.g., version, platform)</li>
                <li class="fragments">Task queues with distributed workers</li>
              </ul>
            </script>
          </section>

          <section data-markdown>
            <script type="text/template">
              ## Characteristics
              <ul>
                <li class="fragments">Web frontend for humans</li>
                <li class="fragments">JSON/REST API for machines</li>
                <li class="fragments">Pluggable code-transformation modules</li>
                <li class="fragments">Works on both emulators and physical devices</li>
              </ul>
            </script>
          </section>
        </section>

        <section>
          <section data-markdown>
            <script type="text/template">
              ![AndroTotal Screenshot](img/scan.png)
            </script>
          </section>

          <section data-markdown>
            <script type="text/template">
              ![AndroTotal Screenshot](img/andrototal-web-0.png)
            </script>
          </section>

          <section data-markdown>
            <script type="text/template">
              ![AndroTotal Screenshot](img/andrototal-web-1.png)
            </script>
          </section>

          <section data-markdown>
            <script type="text/template">
              ![AndroTotal Screenshot](img/andrototal-web-2.png)
            </script>
          </section>

          <section data-markdown>
            <script type="text/template">
              ![AndroTotal Screenshot](img/andrototal-beta.png)
            </script>
          </section>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Writing tests <strike>is</strike> was tedious

            We have abstracted away the low level details, so that

            we can focus on the important things: _extracting the results_.
          </script>
        </section>

        <section>
          <section>
            <h2>AndroPilot</h2>
            <h3>Test Recipe (on-install detection)</h3>
<pre><code class="python">#andrototal-adapters/ComZonerAndroidAntivirus.py
class TestSuite(base.BaseTestSuite):
  def on_install_detection(self, sample_path):
    self.pilot.install_package(sample_path)

    if self.pilot.wait_for_activity(
        "com.zoner.android.antivirus_common.ActScanResults", 10):

      result = self.pilot.get_view_by_id("scaninfected_row_virus")
    else:
      result = False</code></pre>
          </section>

          <section>
            <h3>Test Recipe (on-demand detection)</h3>
<pre><code class="python">#...
def on_demand_detection(self, sample_path):
  self.pilot.install_package(sample_path)
  self.pilot.start_activity("com.zoner.android.antivirus", ".ActMain")
  self.pilot.wait_for_activity("com.zoner.android.antivirus.ActMain")

  self.pilot.tap_on_coordinates(120, 130)
  self.pilot.wait_for_activity("com.zoner.android.antivirus.ActMalware")

  # start scan
  self.pilot.tap_on_coordinates(120, 80)
  self.pilot.wait_for_activity(
    "com.zoner.android.antivirus_common.ActScanResults")

  self.pilot.refre dsh()
# ...</code></pre>
          </section>
        </section>

        <section>
          <img src="img/scraping.png" alt="" />
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Workflow

            <ol class="fragment">
              <li class="fragments">Retrieve a suspicious APK</li>

              <li class="fragments">Choose parameters

                <ul>
                  <li>Android version(s)</li>
                  <li>List of antimalware product and versions</li>
                  <li>Apply chain of mutations</li>
                </ul>

              </li>

              <li class="fragments">Pull clean image(s) from repository</li>
              <li class="fragments">Instantiate one test per combination of

                <ul>
                  <li>Android version</li>
                  <li>Product version</li>
                </ul>

              </li>

              <li class="fragments">Enqueue test instances</li>
            </ol>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Architecture

            <ul class="fragment">
              <li class="fragments">Web frontend</li>
              <li class="fragments">Repository of clean Android images</li>
              <li class="fragments">Asynchronous task dispatcher</li>
              <li class="fragments">Distributed workers</li>
            </ul>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### REST/JSON API and Client

            * Push (public) and pull (invite only) samples

            * Python client: https://bitbucket.org/andrototal/tools

            <pre><code class="python">
$ python andrototal_cli.py -l DEBUG scan -at-key <...> -ms-key <...> path/to/sample.apk sample2.apk more/*samples.apk

Running command: scan
Uploading file sample.apk
Scan response: {"resource": "10a6f3efc8bc40c1922facde7d055208"}
Uploading file sample2.apk
Scan response: {"resource": "e870c6748ca3409f84c9c9e1a91daf3f"}
Uploading file 40156a176bb4554853f767bb6647fd0ac1925eac.apk
Scan response: {"resource": "21d6c7234a184db6b8e52f2bab523787"}
Uploading file samples-3.apk
Scan response: {"resource": "ec5b3c94ed624d6993b52a50d63153fa"}
            </code></pre>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Scalability

            <img class="fragment" src="img/scalability.png" width="75%" />
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            #### 1. Threats and protections

            #### 2. Limitations

            #### 3. Testing antimalware

            #### 4. AndroTotal

            ## 5. Status
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Numbers

            * 1,275 users subscribed
            * 13 antimalware vendors supported (not all public)
            * 16 products overall (not all public)
            * 23,215 distinct APKs submitted and analyzed
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Supported apps (public)
            * ZONER, Inc. - Zoner AntiVirus Free 1.8.0
            * ZONER, Inc. - Zoner AntiVirus Free 1.7.6
            * AVAST Software - avast! Mobile Security 2.0.3917
            * Doctor Web, Ltd - Dr.Web Anti-virus Light (free) 7.00.3
            * Kaspersky Lab - Kaspersky Mobile Security Lite 9.36.28
            * Kaspersky Lab - Kaspersky Mobile Security 10.4.41
            * Trend Micro - Mobile Security & Antivirus 2.6.2
            * Trend Micro - Mobile Security & Antivirus 3.1
            * NortonMobile - Norton Security & Antivirus 3.2.0.769
            * NortonMobile - Norton Security & Antivirus 3.3.4.970
          </script>
        </section>

        <section>
          <table>
            <thead>
              <tr><th>Label</th><th>#</th></tr>
            </thead>
            <tbody>
              <tr><td>UDS:DangerousObject.Multi.Generic    </td><td>3963</td></tr>
              <tr><td>HEUR:Trojan-SMS.AndroidOS.Opfake.bo  </td><td>1252</td></tr>
              <tr><td>not a virus Adware.Airpush.origin.7  </td><td>701 </td></tr>
              <tr><td>AndroidOS Opfake.CTD                 </td><td>700 </td></tr>
              <tr><td>HEUR:Trojan-SMS.AndroidOS.Opfake.a   </td><td>628 </td></tr>
              <tr><td>Android.SmsSend.origin.281           </td><td>620 </td></tr>
              <tr><td>Android:FakeNotify-A [Trj]           </td><td>620 </td></tr>
              <tr><td>HEUR:Trojan-SMS.AndroidOS.FakeInst.a </td><td>512 </td></tr>
              <tr><td>Android.SmsSend.origin.315           </td><td>485 </td></tr>
              <tr><td>HEUR:Backdoor.AndroidOS.KungFu.a     </td><td>466 </td></tr>
              <tr><td>Android.SmsSend.origin.585           </td><td>462 </td></tr>
              <tr><td>Android.SmsSend.origin.629           </td><td>461 </td></tr>
              <tr><td>Adware.AndroidOS.Airpush-Gen         </td><td>432 </td></tr>
              <tr><td>HEUR:Backdoor.AndroidOS.BaseBrid.a   </td><td>390 </td></tr>
              <tr><td>AndroidOS Opfake.CTC                 </td><td>386 </td></tr>
            </tbody>
          </table>
        </section>

        <section>
          <h3>Average speed: No major winner</h3>
          <img src="img/avgtime.png" width="120%" alt="" />
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Future Work

            <ul class="fragment">
              <li class="fragments">Add more cores and scale</li>
              <li class="fragments">Compare labels and detection results with VirusTotal.com</li>
              <li class="fragments">Deploy on ARM boards and monitor power consumption</li>
              <li class="fragments">Open malware repository and API: <strong>anyone interested?</strong></li>
            </ul>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            <img class="logo" src="img/andrototal_logo.png" class="" alt="" />

            ## Grab a sticker!

            # Questions?

            http://andrototal.org

            <a href="http://twitter.com/andrototal_org">@andrototal_org</a>

            <a href="mailto:fede@maggi.cc">fede@maggi.cc</a>
          </script>
        </section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>
      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
      controls: true,
      progress: true,
      history: true,
      center: true,

      theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
      transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none

      // Optional libraries used to extend on reveal.js
      dependencies: [
      { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
      // { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
      // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
      ]
      });
    </script>
  </body>
</html>

<!--  LocalWords:  AndroTotal Scalable Antivirus px img
 -->
